env:
  nsxManager:
    ip: '${NSX_MANAGER_IP}'
    username: 'admin'
    password: '${NSX_MANAGER_PASS}'
  nsxController:
    - ip: '${NSX_CONTROLLER_01_IP}'
      username: 'admin'    
      password: '${NSX_CONTROLLER_01_PASS}'
      secret: 'VMware1!'
  nsxEdge:
    - ip: '${NSX_EDGE_01_IP}'
      username: 'admin'    
      password: '${NSX_EDGE_01_PASS}'
    - ip: '${NSX_EDGE_02_IP}'
      username: 'admin'    
      password: '${NSX_EDGE_02_PASS}'
      
# action: create,update,delete
tasks:
  - module: 'Controller'
    action: 'initialize'
  - module: 'IPPool'
    action: 'create'
    data:
      display_name: 'tep-for-esxi'
      subnets:
        - allocation_ranges:
            - start: '192.168.140.101'
              end: '192.168.140.110'
          cidr: '192.168.140.0/24'
          gateway_ip: '192.168.140.1'
  - module: 'TransportZone'
    action: 'create'
    data:
      display_name: 'OverlayTZ'
      host_switch_mode: 'STANDARD'
      host_switch_name: 'overlayNVDS'
      transport_type: 'OVERLAY'
  - module: 'TransportZone'
    action: 'create'
    data:
      display_name: 'VlanTZ'
      host_switch_mode: 'STANDARD'
      host_switch_name: 'vlanNVDS'
      transport_type: 'VLAN'
  - module: 'HostNode'
    action: 'create'
    data:
      display_name: 'esxicomp-01a'
      os_type: 'ESXI'
      ip: '${ESXI_01_IP}'
      username: '${ESXI_01_USER}'
      password: '${ESXI_01_PASS}'
  - module: 'HostNode'
    action: 'create'
    data:
      display_name: 'esxicomp-02a'      
      os_type: 'ESXI'
      ip: '${ESXI_02_IP}'
      username: '${ESXI_02_USER}'
      password: '${ESXI_02_PASS}'
  - module: 'UplinkProfile'
    action: 'create'
    data:
      display_name: 'esxi-profile'
      mtu: 1600
      transport_vlan: 0
      active_uplink:
        - 'uplink0'
      teaming_policy: 'FAILOVER_ORDER'

  - module: 'UplinkProfile'
    action: 'create'
    data:
      display_name: 'edge-profile'
      mtu: 1600
      transport_vlan: 0
      active_uplink:
        - 'uplink0'
      teaming_policy: 'FAILOVER_ORDER'

  - module: 'TransportNode'
    action: 'create'
    data:
      display_name: 'esxicomp-01a'      
      node: 'esxicomp-01a'      
      nvds:
        - tz: 'OverlayTZ'
          uplink_profile: 'esxi-profile'
          uplink_mapping:
            uplink0: 'vmnic1'
          ip_assignment:
            ippool: 'tep-for-esxi'
  - module: 'TransportNode'
    action: 'create'
    data:
      display_name: 'esxicomp-02a'      
      node: 'esxicomp-02a'
      nvds:
        - tz: 'OverlayTZ'
          uplink_profile: 'esxi-profile'
          uplink_mapping:
            uplink0: 'vmnic1'
          ip_assignment:
            ippool: 'tep-for-esxi'
  - module: 'TransportNode'
    action: 'create'
    data:
      display_name: 'nsxedge-01a'
      node: 'nsxedge-01a'
      nvds:
        - tz: 'OverlayTZ'
          uplink_profile: 'edge-profile'
          uplink_mapping:
            uplink0: 'fp-eth0'
          ip_assignment:
            ippool: 'tep-for-esxi'            
        - tz: 'VlanTZ'
          uplink_profile: 'edge-profile'
          uplink_mapping:
            uplink0: 'fp-eth1'

  - module: 'TransportNode'
    action: 'create'
    data:
      display_name: 'nsxedge-02a'
      node: 'nsxedge-02a'
      nvds:
        - tz: 'OverlayTZ'
          uplink_profile: 'edge-profile'
          uplink_mapping:
            uplink0: 'fp-eth0'
          ip_assignment:
            ippool: 'tep-for-esxi'            
        - tz: 'VlanTZ'
          uplink_profile: 'edge-profile'
          uplink_mapping:
            uplink0: 'fp-eth1'
            
  - module: 'EdgeCluster'
    action: 'create'
    data:
      display_name: 'EdgeCluster1'
      members:
        - 'nsxedge-01a'
        - 'nsxedge-02a'
